<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Create Panel User & Server</title>
  <style>
    body {
      background: #121212;
      color: white;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    form {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px #00000080;
      width: 300px;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border: none;
      border-radius: 6px;
    }
    input {
      background: #333;
      color: white;
    }
    button {
      background: #00c853;
      color: white;
      cursor: pointer;
    }
    #result {
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <form id="createForm">
    <h2>Buat User & Server</h2>
    <input type="text" id="username" placeholder="Username" required>
    <input type="email" id="email" placeholder="Email" required>
    <input type="password" id="password" placeholder="Password" required>
    <button type="submit">Buat Sekarang</button>
  </form>
  <div id="result"></div>

  <script>
    const egg = "15";
    const nestid = "5";
    const loc = "1";
    const domain = "https://ramaxbuyer.shop-panel.biz.id";
    const apikey = "ptla_u1nIoru19Q93R2kg5peiHuqNRYfpwlfzsQJrJUzurqc";
    const capikey = "ptlc_T0XIt9kft6nnmhejcOXrW9hkJdnh1ClctVpU91xdhhr";

    document.getElementById('createForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const resultBox = document.getElementById('result');

      resultBox.innerText = "Membuat user...";

      try {
        // 1. Buat user
        const userRes = await fetch("https://api.client.panel.co.id/users/create", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": capikey
          },
          body: JSON.stringify({
            username: username,
            email: email,
            first_name: username,
            last_name: "User",
            password: password
          })
        });

        const userData = await userRes.json();
        if (!userRes.ok) throw new Error(userData.errors?.[0]?.detail || "Gagal buat user.");

        const userId = userData.attributes?.id || userData.id;

        resultBox.innerText = "User berhasil dibuat. Membuat server...";

        // 2. Buat server
        const serverRes = await fetch(`${domain}/api/application/servers`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apikey}`,
            "Accept": "application/json"
          },
          body: JSON.stringify({
            name: username + "-server",
            user: userId,
            egg: parseInt(egg),
            nest: parseInt(nestid),
            location: parseInt(loc),
            memory: 1024,
            disk: 1024,
            cpu: 50,
            swap: 0,
            io: 500,
            databases: 0,
            backups: 0,
            allocations: 1,
            docker_image: "ghcr.io/parkervcp/yolks:nodejs_18",
            startup: "npm start",
            environment: {
              STARTUP_CMD: "npm start",
              NODE_VERSION: "18"
            },
            feature_limits: {
              databases: 0,
              backups: 0,
              allocations: 1
            },
            deploy: {
              locations: [parseInt(loc)],
              dedicated_ip: false,
              port_range: []
            }
          })
        });

        const serverData = await serverRes.json();
        if (!serverRes.ok) throw new Error(serverData.errors?.[0]?.detail || "Gagal buat server.");

        resultBox.innerHTML = `
          ✅ Server berhasil dibuat!<br>
          <b>User:</b> ${username}<br>
          <b>Login Panel:</b> <a href="${domain}" target="_blank">${domain}</a>
        `;
      } catch (err) {
        resultBox.innerHTML = `<span style="color:red;">❌ ${err.message}</span>`;
      }
    });
  </script>
</body>
  </html>
  
